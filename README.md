# GramPlatformMonorepo

## Requirements

### Install NX

The advantage of a global installation is that you don't have to prefix your commands with npx, yarn or pnpm. The global Nx installation hands off the process execution to the local Nx installation in your repository.
```js
npm add --global nx@latest
```

### Install Poetry
You need a global poetry command available. Example installation with pipx:
```sh
pipx install poetry
```

## Commands
Core command for the development workflow:

```js
nx run project:add tenacity # installs tenacity dep
nx run project:remove tenacity # removes tenacity dep
nx run project:install # installs deps and creates a local venv if not exists (typically you want to run lock command first)
nx run project:lock # recreates the lock file
nx run project:sync # syncs the venv to the definition of the lock file
nx run project:test # runs pytest and generates reports and coverage files
nx run project:lint-check # runs the ruff linter, only check, no apply
nx run project:lint # runs the ruff linter, fixing errors.
nx run project:format-check # run the ruff formatter, only check, no apply
nx run project:format # run the ruff formatter, fixing errors.
```

All command accept extra trailing parameters.
For a detailed view of the commands, inspect the root's `project.json` and project specific `nx.json` files.


## (Optionally) Install Nx Console

Nx Console is an editor extension that enriches your developer experience. It lets you run tasks, generate code, and improves code autocompletion in your IDE. It is available for VSCode and IntelliJ.

[Install Nx Console &raquo;](https://nx.dev/getting-started/editor-setup?utm_source=nx_project&utm_medium=readme&utm_campaign=nx_projects)

## Developer Notes

### Virtual Envs and Interpreters
Since every poetry install will generate a separate venv local to that service
it is advised to set your IDE's interpreter to the venv of the project you are currently
working on. This will allow it to recognize third party and local dependencies, give you 
autocompletion and syntax highlighting as well as the option to run your tests through nx.

### Marking source roots
When developing it is advised to mark all relevant folders that will behave as source roots.
In other words mark any top level service or package relevant to you as root so that
your IDE can recognize the imports and are in line with the entrypoints for code execution in
tests and Docker containers.

### Linting/Formatting
We use [pre-commit](https://pre-commit.com/) to execute git hook scripts at every commit.
After installing it in your local pc, install the git hook scripts using:

```bash
pre-commit install
```

You can also execute the scripts manually using:

```bash
pre-commit run --all-files
```

It is strongly advised to set up a file watcher depending on your IDE to run the pre-commit hooks for example
when saving a file. That way you can have live linting/formatting and you are sure to use the same
versions as the ones of the pre-commit file.

## Docker Compose
To spin up all services navigate to the root of the project and run
```sh
docker compose up
```

## Running alembic migrations
All sqlalchemy models should give the capability to be autogenerated. To run an alembic migration run
```shell
 alembic revision --autogenerate -m "Revision message"
```
and ALWAYS make sure that the generated migration adheres to what you want to do after inspecting/editing the generated file.

